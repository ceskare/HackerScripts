from bs4 import BeautifulSoup

with open('../../materials/evilcorp.html', 'r') as file:
    page = file.read()

soup = BeautifulSoup(page, 'html.parser')

title_tag = soup.title
title_tag.string.replace_with("Evil Corp - Stealing your money every day")

name = soup.find('span', class_='name').text.strip()

new_h1_tag = soup.new_tag('h1')
new_h1_tag.string = f"Mr. {name}, you are hacked!"
soup.body.insert(0, new_h1_tag)

script_tag = soup.new_tag('script')
script_tag.string = '''
hacked = function() {
    alert('hacked');
}
window.addEventListener('load', 
    function() { 
        var f = document.querySelector("form");
        f.setAttribute("onsubmit", "hacked()");
    },
    false
);
'''
soup.body.append(script_tag)

link_tag = soup.find('a', href='https://evilcorp.com/')
if link_tag:
    link_tag['href'] = 'https://mrrobot.fandom.com/wiki/Fsociety'
    link_tag.string.replace_with("Fsociety")

with open('../../materials/evilcorp_hacked.html', 'w') as file:
    file.write(str(soup))
